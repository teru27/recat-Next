(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[130],{3609:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ocr",function(){return __webpack_require__(7627)}])},7627:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return App}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5893),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7294),image_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1664),tesseract_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7320),react_dropzone__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(2002);let stats=[{stats:0,text:"防御力％"},{stats:0,text:"攻撃力％"},{stats:0,text:"HP％"},{stats:0,text:"元素チャージ％"},{stats:0,text:"元素力％"},{stats:0,text:"会心ダメージ％"},{stats:0,text:"会心率"}],holyRelicData=[{text:"防御力",idx:0},{text:"攻撃力",idx:1},{text:"HP",idx:2},{text:"元素チャージ",idx:3},{text:"元素力",idx:4},{text:"会心ダメージ",idx:5},{text:"会心率",idx:6}];function App(){let[base64Images,setBase64Images]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),[imageText,setImageText]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),[msg,setMsg]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),[getStats,setStats]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(stats),getTextImage=async base64CapImg=>{let image=await image_js__WEBPACK_IMPORTED_MODULE_2__.Ee.load(base64CapImg);if(image){let ocrImg=image.crop({x:0,y:350}).flipY().crop({x:1450,y:600}).flipY().grey().toBase64("image/png");return setBase64Images("".concat(ocrImg)),"data:image/png;base64,".concat(ocrImg)}},onDrop=(0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(files=>{if(0===files.length){setMsg("読み込みに失敗しました。");return}let file=files[0];if("image/png"!==file.type&&"image/jpeg"!==file.type){setMsg("png, jpeg以外のファイルがドロップされました。");return}let fileReader=new FileReader;fileReader.onload=()=>{setMsg("読み込み中"),setImageText("");let imageSrc=fileReader.result;getTextImage(imageSrc).then(ocrImg=>{void 0!=ocrImg&&imageToText(ocrImg)})},fileReader.readAsDataURL(file)},[]),{getRootProps,getInputProps,isDragActive}=(0,react_dropzone__WEBPACK_IMPORTED_MODULE_4__.uI)({onDrop}),imageToText=async base64Image=>{let worker=await (0,tesseract_js__WEBPACK_IMPORTED_MODULE_3__.createWorker)("jpn"),{data:{text}}=await worker.recognize(base64Image);await worker.terminate();let a=text.replace(/\s/g,"").split("・");a.forEach((str,idx)=>{let text=str.replace(/\s+/g,""),regex1=/\d+\.\d+\%|\d+\%/;if(regex1.test(text)){let matchText=text.match(regex1);matchText&&holyRelicData.forEach((holyRelic,idx)=>{matchText.input&&-1!==matchText.input.indexOf(holyRelic.text)&&(stats[holyRelic.idx].stats=Number(matchText[0].replace("%","")))})}else/\d+\.\d+|\d+/.test(text)}),setImageText(text.replace(/\s/g,""))};return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{setMsg("")},[imageText]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{children:[""!=msg?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:msg}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{}),"ドラッグ&ドロップ",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{...getRootProps(),style:{height:"400px",width:"400px",border:"solid 1px #000000"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("input",{...getInputProps()}),isDragActive?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{children:"Drop the files here ..."}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{children:"Drag 'n' drop some files here, or click to select files"})]})]}),""!=base64Images?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("img",{src:"data:image/png;base64,".concat(base64Images)})}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{}),stats.map((data,idx)=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{children:[data.text," : ",data.stats,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("br",{})]}))]})}}},function(__webpack_require__){__webpack_require__.O(0,[655,642,832,774,888,179],function(){return __webpack_require__(__webpack_require__.s=3609)}),_N_E=__webpack_require__.O()}]);